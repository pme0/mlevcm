}
}else{
data_X <- dx[select,]
}
# read response (y)
i_y <- select & ((1:nrow(data_A4)) %in% unlist(sapply(idx_A4, "[[", 1)))
data_y <- data_A4[i_y,"Sporozoites"]
return(list(X = data_X, y = data_y, n_replics = n_replics[n_replics != 0], raw_data = data_A4[i_y,]))
}#load_A4
load_B_A1T1 <- function(Params){
# read data
#data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
data <-  read.csv(file = "~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
target_pos <- Params$tp$B_A1T1  # {1,2,3,4}
select <- (!is.na(data[,"Position"])) & (!is.na(data[,"Age"])) & (!is.na(data[,"Location"])) & (!is.na(data[,"Generation"])) & (!is.na(data[,"Species"])) & (data[,"Position"] %in% target_pos)
#select[153:154] <- FALSE # outliers, etc.
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Position"] %in% target_pos) & !is.na(data[rng,"Position"]) & !is.na(data[rng,"Age"]) & (!is.na(data[rng,"Location"])) & (!is.na(data[rng,"Generation"])) & (!is.na(data[rng,"Species"]))
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read predictor (X)
dates    <- c("8Oct17","9Oct17","10Oct17")
nx_dates <- c(  695   ,  782   ,   1025  )
nx <- sum(nx_dates)  # number of spectra files
dx <- matrix(0, nx, 2151);  kk <- 0
for(day in dates){
for(k in 0:(nx_dates[which(dates == day)]-1)){
kk <- kk + 1
#f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
f_name <- paste0("~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
# read response (y)
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
data_y <- factor(data[i_y,"Species"])
# raw data
raw_data <- data[i_y,]   #  table(raw_data[,c("Species","Location","Generation")])
return(list(X = data_X, y = data_y, n_replics = n_replics[n_replics != 0], raw_data = raw_data))
# re-save with simple layout
#data_export <- data.frame(y = y, X = X)
#write.table(data_export, file="~/Dropbox/research/projects/nirs/data/datasets/experiments_Tom/A1_sporozoites/DATASET_sporozoites_2017_06_01.txt", sep=",", row.names=F, col.names=T)
}#load_B_A1T1
load_B_A1E1 <- function(Params){
# read data
#data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1A1_300118_(PEDRO).csv", header=T, na.strings = "NA")
data <-  read.csv(file = "~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1A1_300118_(PEDRO).csv", header=T, na.strings = "NA")
target_pos <- Params$tp$B_A1E1  # {1,2}
select <- (!is.na(data[,"Position"])) & (!is.na(data[,"Age"])) & (!is.na(data[,"Species"])) & (!is.na(data[,"Notes"])) & (!is.na(data[,"Notes"]) & data[,"Notes"] != "fallen") & (data[,"Position"] %in% target_pos) # & (is.na(data[,"Dissect_oocyst"])) #& (data[,"Infection_status"] %in% c("infectious","uninfectious"))  #
#select[153:154] <- FALSE # outliers, etc.
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Position"] %in% target_pos) & !is.na(data[rng,"Position"]) & !is.na(data[rng,"Age"]) & (!is.na(data[rng,"Species"])) & (!is.na(data[rng,"Age"])) & (!is.na(data[rng,"Notes"])) & (!is.na(data[rng,"Notes"]) & data[rng,"Notes"] != "fallen")
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read predictor (X)
dates    <- c("01Nov17","02Dec17","02Nov17","03Dec17","03Nov17","04Dec17","04Nov17","05Dec17","05Nov17","06Dec17","06Nov17", "07Dec17","07Nov17","08Dec17","08Nov17","20Dec17","20Nov17","21Nov17","22Nov17","22Oct17","23Nov17","23Oct17","24Nov17","24Oct17","25Oct17","26Oct17","27Oct17","28Nov17","28Oct17","29Nov17","29Oct17","30Nov17","30Oct17","31Oct17")
nx_dates <- c(    105    ,   121   ,   155   ,   161   ,   197   ,   161   ,   157   ,   135   ,   125   ,   127   ,   103   ,    119   ,   103   ,   41    ,   43    ,   41    ,   61    ,   61    ,   41    ,   61    ,   41    ,   41    ,   161   ,   55    ,   177   ,   177   ,   177   ,   123   ,   151   ,   121   ,   179   ,   141   ,   183   ,   185)
nx <- sum(nx_dates)  # number of spectra files
dx <- matrix(0, nx, 2151);  kk <- 0
for(day in dates){
for(k in 0:(nx_dates[which(dates == day)]-1)){
kk <- kk + 1
#f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Experiment 1, comparative age/E1Age_",day,"_", formatC(k, width = 5,flag = 0),".txt")
f_name <- paste0("~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Experiment 1, comparative age/E1Age_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
# read response (y)
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
data_y <- data[i_y,"Age"]
# raw data
raw_data <- data[i_y,]
return(list(X = data_X, y = data_y, n_replics = n_replics[n_replics != 0], raw_data = raw_data))
# re-save with simple layout
#data_export <- data.frame(y = y, X = X)
#write.table(data_export, file="~/Dropbox/research/projects/nirs/data/datasets/experiments_Tom/A1_sporozoites/DATASET_sporozoites_2017_06_01.txt", sep=",", row.names=F, col.names=T)
}#load_B_A1E1
load_B_A2T2 <- function(Params){
# read data
data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 2 - Pf Infection/NIRS_TEMPLATE_Activity 2 Test2 New version 300118 MOD pedro.csv", header=T, na.strings = "NA")
target_pos <- Params$tp$B_A2T2  # {1,2,3,4}
select <- (!is.na(data[,"Position"])) & (!is.na(data[,"Infection_status"])) & (!is.na(data[,"Notes"])) & (!is.na(data[,"Notes"]) & data[,"Notes"] != "fallen") & (data[,"Position"] %in% target_pos) & (data[,"Feeding_status"] %in% c("Exposed","Inactivated blood Fed")) & (data[,"Age"] %in% c("D14","D15","D18"))# & (is.na(data[,"Dissect_oocyst"])) #& (data[,"Infection_status"] %in% c("infectious","uninfectious"))  #
#select[153:154] <- FALSE # outliers, etc.
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Position"] %in% target_pos) & !is.na(data[rng,"Position"]) & !is.na(data[rng,"Infection_status"])
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read predictor (X)
dates    <- c("14Oct17", "04Nov17", "11Nov17", "15Nov17", "07Dec17", "14Dec17")
nx_dates <- c(   211   ,    309   ,    239   ,    21    ,    201   ,    181   )
nx <- sum(nx_dates)  # number of spectra files
dx <- matrix(0, nx, 2151);  kk <- 0
for(day in dates){
for(k in 0:(nx_dates[which(dates == day)]-1)){
kk <- kk + 1
f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 2 - Pf Infection/Test 2-New version/E1Test2_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
# read response (y)
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
data_y <- data[i_y,"Infection_status"] #as.numeric(data[i_y,"Infection_status"] %in% c("infectious","infected"))
# raw data
raw_data <- data[i_y,]
return(list(X = data_X, y = data_y, n_replics = n_replics[n_replics != 0], raw_data = raw_data))
# re-save with simple layout
#data_export <- data.frame(y = y, X = X)
#write.table(data_export, file="~/Dropbox/research/projects/nirs/data/datasets/experiments_Tom/A1_sporozoites/DATASET_sporozoites_2017_06_01.txt", sep=",", row.names=F, col.names=T)
}#load_B_A2T2
load_B_A2E2 <- function(Params){
# read data
data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 2 - Pf Infection/NIRS_Burkina_A2E2_140518_PEDRO.csv", header=T, na.strings = "NA")
#data <-  read.csv(file = "~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data [offline copy 27apr2018]/Activity 1 - Age/NIRS_E1A1_300118_(PEDRO).csv", header=T, na.strings = "NA")
target_repl <- c(1,2,3)  # {1,2,3} different gemetocytemia levels (1=low, 2=medium, 3=high)
target_pos  <- c('head_right', 'head_left')  # {head_right, head_left, abdomen_right, abdomen_left}
target_age  <- c(3,6)  # {3,6} age when fed
# !(data[rng,"Notes"] %in% c('microsporidies','melinization_and_microsporidies')) &
select <- (data[,"Exclude"] != 'y') & (data[,"Position"] %in% target_pos) & (data[,"Replicate"] %in% target_repl) & (data[,"Age_group"] %in% target_age) & (!is.na(data[,"Infection_status"])) & (!is.na(data[,"Position"])) & (!is.na(data[,"Notes"]))  # & (is.na(data[,"Dissect_oocyst"])) #& (data[,"Infection_status"] %in% c("infectious","uninfectious"))  #
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Exclude"] != 'y') & (data[rng,"Position"] %in% target_pos) & (data[rng,"Replicate"] %in% target_repl) & (data[rng,"Age_group"] %in% target_age) & (!is.na(data[rng,"Infection_status"])) & !is.na(data[rng,"Position"]) & (!is.na(data[rng,"Notes"]))
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read spectra
# replicate 1
dates_A    <- c("24Nov17","26Nov17","28Nov17","30Nov17","02Dec17","04Dec17","06Dec17","08Dec17","10Dec17")
nx_dates_A <- c(   481   ,   485   ,   641   ,   485   ,   481   ,   481   ,   513   ,   321   ,   229   )
nx_A <- sum(nx_dates_A)  # number of spectra files
dx_A <- matrix(0, nx_A, 2151);  kk <- 0
for(day in dates_A){
for(k in 0:(nx_dates_A[which(dates_A == day)]-1)){
kk <- kk + 1
f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 2 - Pf Infection/Experiment 2_replicate 1/E1Test2_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx_A[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
# replicates 2 and 3
dates_B        <- c("26Jan18","28Jan18","30Jan18","01Fev18","03Fev18","05Fev18","07Fev18","09Fev18","11Fev18","13Fev18","19Mars18","21Mars18","23Mars18","25Mars18","27Mars18","29Mars18","31Mars18","02Avr18","04Avr18")
nx_dates_start <- c(    0   ,    481   ,   963   ,  1445   ,  1925   ,  2407   ,  2889   ,  3371   ,  3853   ,  4223   ,   4429   ,   4671   ,   4913   ,   5155   ,   5357   ,   5519   ,   5649   ,   5731  ,   5813  )
nx_dates_end   <- c(   480  ,    962   ,   1444  ,  1924   ,  2406   ,  2888   ,  3370   ,  3852   ,  4222   ,  4428   ,   4670   ,   4912   ,   5154   ,   5356   ,   5518   ,   5648   ,   5730   ,   5812  ,   5858  )
nx_dates_B <- nx_dates_end - nx_dates_start + 1
nx_B <- sum(nx_dates_B)  # number of spectra files
dx_B <- c()
for(day in dates_B){
dx_B_aux <- matrix(0, nx_dates_B[which(day==dates_B)], 2151);  kk <- 1
for(k in nx_dates_start[which(day==dates_B)]:nx_dates_end[which(day==dates_B)]){
f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 2 - Pf Infection/Experiment 2_replicate 2 3/E2PfInfection_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx_B_aux[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
kk <- kk + 1
}
dx_B <- rbind(dx_B, dx_B_aux)
}
# merge
dx <- rbind(dx_A, dx_B)
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
# read response (y)
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
data_y <- data[i_y,"Infection_status"]
# raw data
raw_data <- data[i_y,]
return(list(X = data_X, y = data_y, n_replics = n_replics[n_replics != 0], raw_data = raw_data))
# re-save with simple layout
#data_export <- data.frame(y = y, X = X)
#write.table(data_export, file="~/Dropbox/research/projects/nirs/data/datasets/experiments_Tom/A1_sporozoites/DATASET_sporozoites_2017_06_01.txt", sep=",", row.names=F, col.names=T)
}#load_B_A2E2
#================================   B_A1T1  BURKINA FASO, ACTIVITY 1 EXPERIMENT 1 (AGE, test)
data_B_A1T1 <- load_B_A1T1(Params);   X <- data_B_A1T1$X;   y <- data_B_A1T1$y;   raw_data <- data_B_A1T1$raw_data
colnames(X)
names(X)
X
names(raw_data)
raw_data$Position
raw_data$Experiment
Params$avg_replics<-F
dim(X)
#================================   B_A1T1  BURKINA FASO, ACTIVITY 1 EXPERIMENT 1 (AGE, test)
data_B_A1T1 <- load_B_A1T1(Params);   X <- data_B_A1T1$X;   y <- data_B_A1T1$y;   raw_data <- data_B_A1T1$raw_data
Params$tp$B_A2T2
# read data
#data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
data <-  read.csv(file = "~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
target_pos <- Params$tp$B_A1T1  # {1,2,3,4}
target_pos
select <- (!is.na(data[,"Position"])) & (!is.na(data[,"Age"])) & (!is.na(data[,"Location"])) & (!is.na(data[,"Generation"])) & (!is.na(data[,"Species"])) & (data[,"Position"] %in% target_pos)
#select[153:154] <- FALSE # outliers, etc.
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Position"] %in% target_pos) & !is.na(data[rng,"Position"]) & !is.na(data[rng,"Age"]) & (!is.na(data[rng,"Location"])) & (!is.na(data[rng,"Generation"])) & (!is.na(data[rng,"Species"]))
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read predictor (X)
dates    <- c("8Oct17","9Oct17","10Oct17")
nx_dates <- c(  695   ,  782   ,   1025  )
nx <- sum(nx_dates)  # number of spectra files
dx <- matrix(0, nx, 2151);  kk <- 0
for(day in dates){
for(k in 0:(nx_dates[which(dates == day)]-1)){
kk <- kk + 1
#f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
f_name <- paste0("~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
dim(dx)
Params$avg_replics
length(select)
nx
dim(data)
# read data
#data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
data <-  read.csv(file = "~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
dim(data)
target_pos <- Params$tp$B_A1T1  # {1,2,3,4}
select <- (!is.na(data[,"Position"])) & (!is.na(data[,"Age"])) & (!is.na(data[,"Location"])) & (!is.na(data[,"Generation"])) & (!is.na(data[,"Species"])) & (data[,"Position"] %in% target_pos)
length(select)
#select[153:154] <- FALSE # outliers, etc.
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Position"] %in% target_pos) & !is.na(data[rng,"Position"]) & !is.na(data[rng,"Age"]) & (!is.na(data[rng,"Location"])) & (!is.na(data[rng,"Generation"])) & (!is.na(data[rng,"Species"]))
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read predictor (X)
dates    <- c("8Oct17","9Oct17","10Oct17")
nx_dates <- c(  695   ,  782   ,   1025  )
nx <- sum(nx_dates)  # number of spectra files
dx <- matrix(0, nx, 2151);  kk <- 0
for(day in dates){
for(k in 0:(nx_dates[which(dates == day)]-1)){
kk <- kk + 1
#f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
f_name <- paste0("~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
dim(dx)
Params$avg_replics
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
# read response (y)
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
data_y <- factor(data[i_y,"Species"])
# raw data
raw_data <- data[i_y,]   #  table(raw_data[,c("Species","Location","Generation")])
dim(raw_data)
raw_data
table(raw_data$Position)
dim(dx)
Params$avg_replics
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
dim(data_X)
# read response (y)
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
data_y <- factor(data[i_y,"Species"])
# raw data
raw_data <- data[i_y,]   #  table(raw_data[,c("Species","Location","Generation")])
dim(raw_data)
dim(data)
Params$avg_replics
idx
i_y <- select & ((1:nrow(data)) %in% unlist(idx))
length(i_y)
data_y <- factor(data[i_y,"Species"])
length(data_y)
# raw data
raw_data <- data[i_y,]   #  table(raw_data[,c("Species","Location","Generation")])
dim(data_X)
dim(raw_data)
load_B_A1T1 <- function(Params){
# read data
#data <-  read.csv(file = "~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
data <-  read.csv(file = "~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/NIRS_E1T1_(PEDRO).csv", header=T, na.strings = "NA")
target_pos <- Params$tp$B_A1T1  # {1,2,3,4}
select <- (!is.na(data[,"Position"])) & (!is.na(data[,"Age"])) & (!is.na(data[,"Location"])) & (!is.na(data[,"Generation"])) & (!is.na(data[,"Species"])) & (data[,"Position"] %in% target_pos)
#select[153:154] <- FALSE # outliers, etc.
unique_IDs <- unique(data[select,"Mosquito_ID"])
# indices of repetitions for each mosquito
idx <- list()
for(i in unique_IDs){
rng <- which(data[,"Mosquito_ID"] == i)   #which((data[,"Mosquito_ID"])[data[,"Mosquito_ID"] == i])
aux <- (data[rng,"Position"] %in% target_pos) & !is.na(data[rng,"Position"]) & !is.na(data[rng,"Age"]) & (!is.na(data[rng,"Location"])) & (!is.na(data[rng,"Generation"])) & (!is.na(data[rng,"Species"]))
idx[[i]] <- rng[aux]
}
n_replics <- unlist(lapply(idx, length))  # store how many repeated observations for each specimen
# read predictor (X)
dates    <- c("8Oct17","9Oct17","10Oct17")
nx_dates <- c(  695   ,  782   ,   1025  )
nx <- sum(nx_dates)  # number of spectra files
dx <- matrix(0, nx, 2151);  kk <- 0
for(day in dates){
for(k in 0:(nx_dates[which(dates == day)]-1)){
kk <- kk + 1
#f_name <- paste0("~/Dropbox/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
f_name <- paste0("~/DROPBOX_overflow/research/projects/nirs/data/datasets/Burkina NIRS Data/Activity 1 - Age/Test 1B/E1Test1_",day,"_", formatC(k, width = 5,flag = 0),".txt")
dx[kk,] <- read.table(file = f_name, header=T, sep="\t")[,2]
}
}
# average replications
if(Params$avg_replics){
data_X <- c()
for(i in unique_IDs){
if(length(idx[[i]]) > 1){
data_X <- rbind(data_X, colMeans(dx[idx[[i]],]))
}else{
data_X <- rbind(data_X, dx[idx[[i]],])
}
}
}else{
data_X <- dx[select,]
}
# read response (y)
if(Params$avg_replics){
i_y <- select & ((1:nrow(data)) %in% unlist(sapply(idx, "[[", 1)))
}else{
i_y <- select & ((1:nrow(data)) %in% unlist(idx))
}
data_y <- factor(data[i_y,"Species"])
# raw data
raw_data <- data[i_y,]   #  table(raw_data[,c("Species","Location","Generation")])
return(list(X = data_X, y = data_y, n_replics = n_replics[n_replics != 0], raw_data = raw_data))
# re-save with simple layout
#data_export <- data.frame(y = y, X = X)
#write.table(data_export, file="~/Dropbox/research/projects/nirs/data/datasets/experiments_Tom/A1_sporozoites/DATASET_sporozoites_2017_06_01.txt", sep=",", row.names=F, col.names=T)
}#load_B_A1T1
#================================   B_A1T1  BURKINA FASO, ACTIVITY 1 EXPERIMENT 1 (AGE, test)
data_B_A1T1 <- load_B_A1T1(Params);   X <- data_B_A1T1$X;   y <- data_B_A1T1$y;   raw_data <- data_B_A1T1$raw_data
dim(X)
table( raw_data$Position)
names(raw_data)
table(raw_data$Generation)
table(raw_data$Location)
data_zenodo <- list(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species,
X = X)
dim(data_zenodo)
data_zenodo
str(data_zenodo)
raw_data$Species,
raw_data$Species
data_zenodo <- list(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species)
data_zenodo <- cbind(data_zenodo, X)
dim(X)
dim(data_zenodo)
data_zenodo <- list(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species)
data_zenodo <- cbind(data_zenodo, X)
data_zenodo <- list(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species)
dim(data_zenodo)
str(data_zenodo)
data_zenodo <- matrix(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species)
raw_data$Scan_ID
cbind(raw_data$Scan_ID, raw_data$Mosquito_ID)
View(raw_data)
data_zenodo <- cbind(raw_data$Scan_ID, raw_data$Mosquito_ID, raw_data$Position, raw_data$Location, raw_data$Generation, raw_data$Species, X)
data_zenodo
dim(data_zenodo)
colnames(data_zenodo)
names(data_zenodo)
str(data_zenodo)
colnames(data_zenodo) <- c("Scan_ID", "Mosquito_ID", "Position", "Location", "Generation", "Species", paste0("X",350:2500))
data_zenodo
top(data_zenodo)
head(data_zenodo)
data_zenodo[1:3,]
write.table(data_zenodo, file="~/Dropbox/research/projects/nirs/data/zenodo/A1T1.txt", sep=",", row.names=F)
data_zenodo <- data.frame(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species)
data_zenodo
data_zenodo <- cbind(data_zenodo, X)
data_zenodo
colnames(X)
colnames(X) <- paste0("x",350:2500)
colnames(X)
data_zenodo <- data.frame(Scan_ID = raw_data$Scan_ID,
Mosquito_ID = raw_data$Mosquito_ID,
Position = raw_data$Position,
Location = raw_data$Location,
Generation = raw_data$Generation,
Species = raw_data$Species)
data_zenodo <- cbind(data_zenodo, X)
write.table(data_zenodo, file="~/Dropbox/research/projects/nirs/data/zenodo/A1T1.txt", sep=",", row.names=F)
write.table
?write.table
data_zenodo
dim(data_zenodo)
